'use client';

import Link from 'next/link';
import { usePathname } from 'next/navigation';
import { useEffect, useState } from 'react';
import { usePrivy } from '@privy-io/react-auth';
import { AnimatePresence, motion, useScroll } from 'framer-motion';
import Avatar from 'boring-avatars';
import BackButton from './back-button';

const UserNavButton = () => {
  const { user, logout } = usePrivy();
  return (
    <div className="flex items-center gap-2">
      <div className="flex items-center gap-2">
        {user?.farcaster?.pfp ? (
          <img src={user.farcaster.pfp} alt="User avatar" className="h-8 w-8 rounded-full" />
        ) : (
          <Avatar
            size={32}
            name={user?.farcaster?.displayName || 'User'}
            variant="beam"
            colors={['#92A1C6', '#146A7C', '#F0AB3D', '#C271B4', '#C20D90']}
          />
        )}
        <p className="text-sm font-medium">{user?.farcaster?.displayName || 'User'}</p>
      </div>
    </div>
  );
};

export default function Navbar() {
  const { scrollY } = useScroll();
  const [isScrolled, setIsScrolled] = useState(false);
  const pathname = usePathname();

  useEffect(() => {
    const unsubscribe = scrollY.onChange((latest) => {
      setIsScrolled(latest > 10); // Reduced threshold for quicker response
    });
    return () => unsubscribe();
  }, [scrollY]);

  const isHome = pathname === '/';

  return (
    <motion.nav
      className="fixed inset-x-0 top-0 z-50 bg-gradient-to-b from-white to-white/70 backdrop-blur-md"
      initial={{ height: 80 }}
      animate={{ height: isScrolled ? 60 : 80 }}
      transition={{ duration: 0.3 }}
    >
      <AnimatePresence mode="wait">
        {!isHome && (
          <motion.div
            initial={{ x: -20, y: 16, scale: 0.7, opacity: 0 }}
            animate={{ x: 0, y: 16, scale: 1, opacity: 1 }}
            exit={{ x: -20, y: 16, scale: 0.7, opacity: 0 }}
            transition={{
              duration: 0.3,
              type: 'spring',
            }}
            className="absolute translate-y-1/2 "
          >
            <BackButton isScrolled={isScrolled} />
          </motion.div>
        )}
      </AnimatePresence>
      <div className="xl:px-4 mx-auto flex justify-between items-center h-full px-4">
        <Link href="/" prefetch={false} className="w-fit mx-auto">
          <motion.div
            className="flex items-center gap-2"
            animate={{ scale: isScrolled ? 0.8 : 1 }}
            transition={{ duration: 0.3 }}
          >
            <motion.svg
              width="534"
              height="289"
              viewBox="0 0 534 289"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
              className="w-14"
              animate={{
                width: isScrolled ? 42 : 52,
                height: isScrolled ? 42 : 52,
              }}
              transition={{ duration: 0.3 }}
            >
              {/* SVG path data */}
              <path
                d="M97.2976 3.74513C102.609 7.86384 105.042 13.1272 107.173 19.3701C107.421 20.0926 107.67 20.8152 107.926 21.5596C114.337 40.7003 118.806 60.1006 121.36 80.1201C121.463 80.9256 121.566 81.7311 121.673 82.561C123.76 100.846 125.653 124.487 116.36 141.12C112.736 145.316 109.849 147.692 104.29 148.374C98.669 148.669 94.7494 147.693 90.3601 144.12C87.7023 141.209 85.412 138.192 83.1101 134.995C77.9221 129.571 72.917 127.97 65.4191 127.648C56.7851 127.535 51.1682 128.831 44.6101 134.495C38.0846 142.108 35.7887 148.715 35.9929 158.675C36.9803 167.94 41.0992 174.998 47.9187 181.222C51.825 184.259 55.7628 186.318 60.3601 188.12C61.8257 188.708 61.8257 188.708 63.321 189.308C78.1506 194.58 93.4032 193.143 107.649 186.612C125.137 177.094 132.883 161.497 138.36 143.12C143.94 122.253 143.29 96.9108 137.828 76.0913C137.091 72.9846 137.108 69.931 137.048 66.7451C136.991 64.8154 136.991 64.8154 136.934 62.8467C137.559 57.3747 139.924 54.3848 143.985 50.8076C149.105 47.1699 154.23 47.5424 160.36 48.1201C165.634 50.6629 169.194 54.0913 171.317 59.6052C173.726 66.8111 175.615 74.0131 177.235 81.4326C179.399 91.0894 181.757 100.669 184.312 110.229C186.031 116.707 190.133 126.529 191.36 133.12C191.142 132.321 191.571 133.896 191.36 133.12C191.579 131.874 191.798 130.627 192.024 129.343C195.427 110.745 200.481 88.1888 215.36 75.1201C219.54 72.4747 223.552 72.5995 228.36 73.1201C233.58 74.773 236.854 76.9132 240.36 81.1201C242.087 84.7659 242.715 88.0668 243.173 92.0576C245.372 107.016 251.212 119.474 262.829 129.3C272.146 136 281.956 139.209 293.235 140.245C294.554 140.375 294.554 140.375 295.899 140.507C298.052 140.717 300.206 140.92 302.36 141.12C301.232 137.737 300.396 137.143 297.673 134.995C289.983 128.42 286.336 120.649 283.36 111.12C282.948 109.903 282.535 108.686 282.11 107.433C279.208 94.7521 281.194 81.5335 287.798 70.4092C293.559 61.9692 300.335 55.8852 309.36 51.1201C310.177 50.6857 310.995 50.2513 311.837 49.8037C322.694 44.98 337.373 45.6565 348.598 49.0225C368.121 56.782 382.535 73.7408 390.923 92.6201C405.704 129.716 402.208 168.462 386.801 204.796C385.963 206.628 385.103 208.452 384.208 210.257C383.222 212.082 383.222 212.082 383.36 214.12C410.178 217.656 438.879 215.936 461.149 198.999C462.872 197.606 464.58 196.194 466.266 194.757C468.36 193.12 471.36 190.401 473.36 188.12C474.371 186.967 475.416 185.844 476.485 184.745C492.038 167.252 497.537 144.211 497.798 121.433C497.82 120.209 497.842 118.986 497.865 117.725C497.838 107.196 495.984 97.0209 489.036 88.7451C484.207 84.0626 479.59 82.8607 472.923 82.5576C465.856 82.7951 460.919 84.7795 455.77 89.6123C449.419 96.7184 449.913 104.073 450.36 113.12C451.267 125.531 459.765 137.818 466.794 147.667C469.58 152.03 469.788 155.985 469.36 161.12C467.425 166.331 465.144 170.721 460.044 173.284C457.06 174.214 454.546 174.455 451.423 174.495C450.424 174.523 449.425 174.552 448.395 174.581C443.18 173.789 440.249 171.151 436.868 167.23C436.059 166.12 435.265 165 434.485 163.87C434.059 163.262 433.634 162.655 433.195 162.029C419.544 141.987 410.866 118.282 415.048 93.8701C417.397 84.2441 420.883 75.6534 427.36 68.1201C428.144 67.0889 428.928 66.0576 429.735 64.9951C439.626 54.1618 453.952 47.5856 468.524 46.7139C480.517 46.3763 489.72 47.3479 500.36 53.1201C501.206 53.5765 502.051 54.0328 502.923 54.5029C519.631 64.6559 527.735 80.8596 532.36 99.1201C533.739 106.182 533.604 113.268 533.61 120.433C533.611 121.514 533.611 121.514 533.612 122.617C533.596 133.422 533.104 143.616 530.36 154.12C530.183 154.821 530.006 155.522 529.824 156.244C527.317 166.033 523.976 175.101 519.36 184.12C518.887 185.064 518.414 186.007 517.926 186.98C502.48 216.617 475.482 236.844 444.036 246.909C431.732 250.294 419.828 251.637 407.11 251.495C406.399 251.492 405.687 251.488 404.954 251.485C391.975 251.414 379.112 250.675 366.587 247.019C363.276 245.941 363.276 245.941 359.36 246.12C357.764 247.528 357.764 247.528 356.36 249.495C338.99 270.405 309.918 284.55 283.219 287.87C259.906 289.38 237.507 288.716 218.86 272.745C209.193 263.379 203.423 251.785 203.067 238.246C202.929 222.656 208.121 211.392 218.419 199.804C232.651 186.055 251.632 181.339 270.86 181.558C271.896 181.565 271.896 181.565 272.953 181.573C290.758 181.744 306.586 185.418 323.235 191.62C324.235 191.987 325.236 192.355 326.267 192.733C327.182 193.098 328.097 193.463 329.04 193.839C329.852 194.158 330.664 194.477 331.5 194.806C333.36 196.12 333.36 196.12 334.243 198.572C334.42 202.436 332.275 204.601 329.923 207.433C329.239 208.286 329.239 208.286 328.541 209.157C324.028 214.706 319.34 220.133 313.36 224.12C307.089 224.759 301.715 223.002 295.798 221.183C280.704 216.624 265.333 214.221 250.673 221.444C245.655 224.223 241.703 226.688 239.36 232.12C238.36 235.62 238.86 243.12 242.36 247.12C245.86 251.12 258.75 252.663 267.985 252.558C268.944 252.549 269.902 252.54 270.89 252.53C290.351 252.062 306.31 244.226 321.786 232.905C324.36 231.12 331.86 223.62 332.825 222.69C348.37 206.789 357.467 185.553 362.36 164.12C362.564 163.339 362.767 162.558 362.977 161.753C367.885 140.173 363.898 116.055 352.657 97.1123C348.141 90.1747 343.382 85.7704 335.36 83.1201C330.756 82.4185 326.887 82.5889 322.485 84.1201C318.118 88.2308 315.639 94.329 315.048 100.245C315.948 111.409 323.583 119.993 331.719 127.05C334.223 129.012 336.779 130.777 339.429 132.529C349.307 139.068 349.307 139.068 351.36 145.12C352.279 150.682 351.555 155.445 348.719 160.339C342.824 168.064 332.324 169.264 323.36 171.12C322.311 171.349 322.311 171.349 321.241 171.582C294.478 177.312 267.883 174.949 244.36 160.12C237.136 155.075 229.743 148.116 224.36 141.12C224.36 141.8 224.36 140.46 224.36 141.12C225.04 141.12 223.7 141.12 224.36 141.12C223.042 149.221 220.197 158.393 218.548 166.433C218.195 168.267 218.195 168.267 217.835 170.138C216.182 178.125 214.53 183.967 207.798 189.058C201.843 190.898 195.678 191.716 189.899 188.937C181.976 183.14 175.331 174.549 170.36 166.12C170.36 166.8 170.36 165.46 170.36 166.12C170.446 165.271 170.276 166.944 170.36 166.12C168.36 170.138 165.499 174.326 163.423 178.183C163.026 178.924 162.63 179.666 162.222 180.43C157.211 189.548 151.045 198.054 143.36 205.12C123.625 221.461 96.6906 229.905 71.3601 228.12C49.192 225.358 28.545 214.822 14.2233 197.542C2.57442 181.471 -2.08532 163.435 0.860062 143.784C1.54405 140.823 2.38003 137.996 3.36006 135.12C3.67717 134.148 3.99428 133.176 4.321 132.175C9.43854 118.274 19.9172 105.611 33.4216 99.1309C52.3595 90.9827 68.2536 92.5643 87.3601 99.1201C86.8169 94.6023 86.2488 90.0883 85.6677 85.5752C85.3624 83.1388 85.0833 80.7004 84.8054 78.2607C82.7656 61.3706 78.4458 45.0276 72.4226 29.1201C70.2064 23.0975 68.7583 18.0646 71.2468 11.9365C76.5435 2.34615 87.1521 -1.44762 97.2976 3.74513Z"
                fill="#020202"
              />
              <path
                d="M161.36 3.12013C166.073 7.60028 168.479 11.3133 168.673 17.9326C168.616 22.7863 167.636 25.4018 164.36 29.1201C159.282 33.8078 154.591 35.7187 147.708 35.5694C142.339 34.5421 138.572 30.7623 135.423 26.4951C132.976 21.026 132.419 15.832 134.423 10.0576C137.121 5.9658 140.587 2.01751 145.376 0.46779C151.439 -0.594452 155.995 0.0959435 161.36 3.12013Z"
                fill="#040404"
              />
            </motion.svg>
          </motion.div>
        </Link>
      </div>
    </motion.nav>
  );
}
